<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MediaTool</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
  <style>
    #editor-panel { position: fixed; top: 0; right: -450px; width: 450px; height: 100%; background: #fff;
      border-left: 1px solid #ccc; padding: 20px; transition: right .3s; overflow-y: auto; z-index:1000;
    }
    #editor-panel.open { right: 0; }
  </style>
</head>
<body>
<div class="container mt-4">
  <div class="text-center"></div>
  <h2 style="text-align: center;">MediaTool</h2>
  <button id="btn-run" class="btn btn-success mb-3">ç«‹å³æ‰§è¡Œä»»åŠ¡</button>
  <hr>
  <div class="d-flex justify-content-between align-items-center">
    <h4>ä»»åŠ¡é…ç½®åˆ—è¡¨</h4>
    <button id="btn-new" class="btn btn-primary btn-sm">â• æ–°å»ºé…ç½®</button>
  </div>
  <ul id="config-list" class="list-group mt-2">
    {% for cfg in configs %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div class="form-check">
        <input class="form-check-input config-toggle" type="checkbox" data-name="{{ cfg.name }}" {% if cfg.enabled != false %}checked{% endif %}>
        <label class="form-check-label">{{ cfg.name }}</label>
      </div>
      <div>
        <button class="btn btn-sm btn-outline-secondary mr-2" onclick="editConfig('{{ cfg.name }}')">ç¼–è¾‘</button>
        <button class="btn btn-sm btn-outline-danger" onclick="deleteConfig('{{ cfg.name }}')">åˆ é™¤</button>
      </div>
    </li>
    {% else %}
    <li class="list-group-item">æš‚æ— é…ç½®</li>
    {% endfor %}
  </ul>
</div>

<hr>
<h4 class="text-center mt-4">ğŸ“Š åª’ä½“åº“ç»Ÿè®¡</h4>
<div class="d-flex justify-content-center">
  <canvas id="media-chart" style="max-width: 300px; max-height: 300px;"></canvas>
</div>
<div class="text-center">
  <button class="btn btn-sm btn-outline-info mt-2" onclick="loadStats()">é‡æ–°åŠ è½½ç»Ÿè®¡</button>
</div>

<!-- ä¾§è¾¹ç¼–è¾‘é¢æ¿ -->
<div id="editor-panel">
  <h5>é…ç½®ç¼–è¾‘</h5>
  <form id="cfg-form" onsubmit="saveConfig(event)">
    <div class="form-group">
      <label>é…ç½®åç§°</label>
      <input type="text" id="cfg-name" class="form-control" required>
    </div>
    <div class="form-group">
      <label>æ–‡ä»¶ç±»å‹</label>
      <select id="cfg-file-type" class="form-control">
        <option value="movie">ç”µå½±</option>
        <option value="tv_show">ç”µè§†å‰§</option>
      </select>
    </div>
    <div class="form-group">
      <label>TMDB API Key</label>
      <input type="text" id="cfg-tmdb-api-key" class="form-control" placeholder="è¯·è¾“å…¥ TMDB API Key">
    </div>
    <div id="path-mappings"></div>
    <button type="button" class="btn btn-sm btn-outline-primary mb-2" onclick="addPath()">â• æ·»åŠ è·¯å¾„æ˜ å°„</button>
    <div class="form-check mt-2">
      <input class="form-check-input" type="checkbox" id="cfg-enable-scrape" checked>
      <label class="form-check-label" for="enable-scrape">
        æŠ“å–å…ƒæ•°æ®ï¼ˆTMDBï¼‰
      </label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" id="cfg-enable-rename" checked>
      <label class="form-check-label" for="cfg-enable-rename">
        æ‰§è¡Œæ–‡ä»¶é‡å‘½å
        <span id="rename-hint" class="text-muted small d-block mt-1">
          âš ï¸ ä»…åœ¨å¯ç”¨å…ƒæ•°æ®æŠ“å–åå¯é‡å‘½å
        </span>
      </label>
    </div>
    <div class="form-group">
      <label>æ–‡ä»¶åç¼€ï¼ˆå¦‚ .mp4,.mkvï¼‰</label>
      <input type="text" id="cfg-suffixes" class="form-control">
    </div>
    <div class="form-group">
      <label>é‡å‘½åè§„åˆ™ï¼ˆå¦‚{title}.{year}ï¼‰</label>
      <input type="text" id="cfg-rename" class="form-control" placeholder="">
      <small class="form-text text-muted">ç¤ºä¾‹å¦‚ä¸‹</small>
      <small class="form-text text-muted">ç”µå½±ï¼š{title}.{year}</small>
      <small class="form-text text-muted">å‰§é›†ï¼š{title}.{year}.S{season}.E{episode}.{episode_title}</small>
    </div>
    <div class="form-group">
      <label>å®šæ—¶æ‰«æé—´éš”ï¼ˆåˆ†é’Ÿï¼Œ0=ä¸å¯ç”¨ï¼‰</label>
      <input type="number" id="cfg-interval" class="form-control" value="0" min="0">
    </div>
    <button class="btn btn-success">ä¿å­˜</button>
    <button type="button" class="btn btn-secondary ml-2" onclick="closeEditor()">å–æ¶ˆ</button>
  </form>
</div>

<!-- è¿›åº¦å¯¹è¯æ¡† -->
<div class="modal fade" id="progressModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ä»»åŠ¡è¿›åº¦</h5>
      </div>
      <div class="modal-body">
        <div class="progress mb-3"style="width:90%;height:24px;margin:auto;">
          <div id="progress-bar" class="progress-bar" style="width:0%">0%</div>
        </div>
        <div id="progress-stats" class="mb-3">
          <p id="progress-text" class="mb-2">0 / 0</p>
          <p id="elapsed-time" class="mb-2 text-muted">è€—æ—¶ï¼š00:00:00</p>
          <p class="mb-2">æˆåŠŸï¼š<span id="success-count" class="text-success">0</span></p>
          <p class="mb-2">å¤±è´¥ï¼š<span id="failed-count" class="text-danger">0</span></p>
        </div>
        <div id="error-list" class="mt-3" style="display:none;">
          <h6 class="text-danger">å¤±è´¥æ–‡ä»¶åˆ—è¡¨</h6>
          <ul id="error-details" class="list-unstyled text-danger pl-3" style="font-size: 1rem;"></ul>
        </div>
        </div>
        <div id="complete-message" class="alert mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/jquery-3.5.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
